---
layout: ../../layouts/BlogLayout.astro
title: サイトを作り直し、ブログをHatenaから移管しました
date: 2022-11-17
description: 今までのサイトを書き直し、ブログもはてなブログから統合しました
image: /images/blog/30-years-old/ogp.png
tags: site
---

import OG from "../../components/OG.astro";

タイトルの通り、hiroppy.me のサイトを刷新しそこにブログが入ったことによりブログも移管することにしました。

<OG url="https://hiroppy.me" />

特に意識してなかったのですが、はてなブログの方が、ちょうど 100 記事目の時に移行するという流れになってしまいました。。
はてなブログは有料会員で 4 年間ぐらいやっていたのですが、最近はあまり記事を書けてないために広告置いてもお金にならないですし、当初の目的である独自ドメイン対応でのはてブの通知(ブックマークや引用)も今はあまり見なくなってしまいました。
また、ブログの名前が**技術探し**ですが、最近はプライベートの話やそもそも技術を昔以上に探せてない点があり、もう自分としては役割を終えたのかなと思っています。

今後は、こちらに色々な分野の話を気ままに書いていければと思います。徐々に過去の記事もこちらへ移していこうと思いますが、量が多すぎてやる気と相談します。移行したことによって、ドメインの信頼度が低いため今後検索で記事が出てきづらくなる可能性が高くこれは大きなデメリットとなります。

## Gatsby から Astro へ

前のサイトは Gatsby で書かれており、今回のサイトは Astro で構築されました。理由としては、**JS がない軽量なもので良いものであった**のと**素の HTML に近いものを持っておきたかった**からです。CSS も以前は styled-components を利用していましたが、今回は tailwindcss にしました。
これも理由が同じで素の CSS に近い状態を保持しやすいからです。

## Netlify から Vercel へ

これは Vercel に東京リージョンが存在するからという理由で移行しました。最初引き続き Netlify を使っていましたが、体感でわかるぐらいには遅いのがわかりました。Vercel への移行はかなり簡単でしたが、`Cache-control`が全てに対して `public, max-age=0, must-revalidate`なのは
astro プロジェクトってことを vercel 側から自動的に判断されるので、ついでに`assets`以下は自動で値変えてほしい気持ちがありました。ちゃんとした状態にするには vercel.json は必ず使わないとダメそうです。

<OG url="https://zenn.dev/link/comments/dbecd011374263" />

## Markdown でブログを書くのは難しい

素の Markdown でブログを作るのは無理だと思っていて、例えば OGP の展開はみんなどうやっているんでしょう。
このサイトでは MDX を使って OGP 用のコンポーネントを用意してそこで展開しています。Twitter や Youtube は`iframe`で良いのですが、OGP が悩みどころ。もう一つの方法としては、remark で AST をいじって挿入する感じですが、これはこれで大変なので MDX が良い落ちどころとなりました。

## Deps のアップデートは自動で

Playwright の VRT を使い、テストが落ちたら修正するが落ちなかったらマージにして極力 PR を見ないようにする。

---
import type { TimelineJob } from "../../utils/jobs/timelineCalculations";
import { formatDuration } from "../../utils/jobs/timelineCalculations";
import Image from "../Image.astro";
import { cn } from "../../utils/cn";

type Props = {
  job: TimelineJob;
};

const { job } = Astro.props;

const barClasses = cn(
  "absolute rounded-lg shadow-sm transition-all duration-200 group cursor-pointer text-left",
  "hover:shadow-md focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:outline-none",
  job.type === "main"
    ? "bg-cyan-100 hover:bg-cyan-200 dark:bg-cyan-700/45 dark:hover:bg-cyan-700/55"
    : "bg-green-100 hover:bg-green-200 dark:bg-green-700/45 dark:hover:bg-green-700/55",
);

const textColorClass =
  job.type === "main"
    ? "text-gray-600 dark:text-cyan-400"
    : "text-gray-600 dark:text-green-400";

const topPosition = job.row * 72;
const durationText = formatDuration(job.durationMonths);
---

<button
  type="button"
  class={barClasses}
  style={`left: ${job.startPercent}%; width: ${job.widthPercent}%; top: ${topPosition}px;`}
  data-job-id={job.id}
  data-job-type={job.type}
  data-timeline-bar
  title={`${job.name} - ${job.position} (${durationText})`}
  aria-label={`${job.name}の詳細にスクロール`}
>
  <div class="flex h-16 items-start gap-2 px-2 py-2 lg:h-16 lg:px-3">
    <!-- Company Logo -->
    <div class="shrink-0">
      <div
        class="flex h-8 w-8 items-center justify-center rounded-full bg-white shadow-sm lg:h-10 lg:w-10"
      >
        <Image
          src={job.logo}
          alt={job.name}
          width={32}
          height={32}
          class="h-6 w-6 rounded-full object-contain p-0.5 lg:h-8 lg:w-8"
        />
      </div>
    </div>

    <div class="min-w-0 flex-1">
      <div
        class="text-sm font-bold whitespace-nowrap text-gray-900 lg:text-base dark:text-white"
      >
        {job.name}
      </div>
      <div
        class={cn(
          "flex items-center gap-1.5 text-xs lg:text-xs",
          textColorClass,
        )}
      >
        <span class="font-medium whitespace-nowrap">{job.position}</span>
        <span class="shrink-0">{"/"}</span>
        <span class="shrink-0">{durationText}</span>
      </div>
    </div>
  </div>
</button>

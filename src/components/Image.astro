---
type Props = {
  src: string;
  alt: string;
  className?: string;
  lazy?: boolean;
  // TODO: remove
  webp?: boolean;
};

const { src, alt, className, lazy = false, webp } = Astro.props;
const placeholderColor =
  "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcfPRvPQAHHgLWeG8FbgAAAABJRU5ErkJggg==";
// TODO: only support webp
const defaultSrc = webp ? src.replace(/\.(png|jpg)$/, ".webp") : src;
---

<img
  src={defaultSrc}
  class={className}
  decoding="async"
  alt={alt}
  loading={lazy ? "lazy" : "eager"}
  onerror={`this.onerror=null; this.src='data:image/png;base64,${placeholderColor}'`}
/>

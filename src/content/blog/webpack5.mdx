---
layout: ../../layouts/BlogLayout.astro
title: webpack@5ã®ä¸»ãªå¤‰æ›´ç‚¹ã¾ã¨ã‚
date: 2020-10-09
description: webpack v5ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã§ã€è¿½åŠ ã•ã‚ŒãŸæ©Ÿèƒ½ç­‰ã‚’è§£èª¬ã—ã¾ã™
image: /images/brands/webpack.png
tags: webpack
hatenaPath: webpack5
---

import OG from "../../components/OG.astro";
import TwitterCard from "../../components/TwitterCard.astro";

äºˆå®šã§ã¯ã€æ˜æ—¥ã® 10 æ—¥ã« webpack ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ã‚‹ v5 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ãŒã€ã¾ã ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒå®‰å®šã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ³¨æ„ã—ã¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

<OG url="https://github.com/webpack/webpack/issues/11406" />

change log: https://github.com/webpack/changelog-v5

ç§»è¡Œã‚¬ã‚¤ãƒ‰: https://webpack.js.org/migrate/5

## è¿½åŠ æ©Ÿèƒ½

### Persistent Caching

ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã¯ä»Šã¾ã§ãƒ¡ãƒ¢ãƒªä¸Šã§ã—ã‹è¡Œã£ã¦ãªã‹ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå°å…¥ã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€å¤§å¹…ãªé€Ÿåº¦æ”¹å–„ãŒè¦‹è¾¼ã‚ã¾ã™ã€‚

```javascript
module.exports = {
  cache: {
    type: "filesystem",
    buildDependencies: {
      config: [__filename],
    },
  },
};
```

ãªã— â†“

```
asset main.js 36.3 KiB [emitted] [minimized] (name: main)
orphan modules 584 KiB [orphan] 554 modules
cacheable modules 117 KiB
  ./src/index.js + 103 modules 117 KiB [built] [code generated]
  ./src/foo.js 21 bytes [built] [code generated]
webpack 5.0.0-rc.2 compiled successfully in 1836 ms
```

ã‚ã‚Š â†“

```
asset main.js 36.3 KiB [compared for emit] [minimized] (name: main)
cached modules 700 KiB [cached] 556 modules
webpack 5.0.0-rc.2 compiled successfully in 429 ms
```

è©³ã—ãã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§ã«ã—ã¦ãã ã•ã„ã€‚

<OG url="https://blog.hiroppy.me/entry/webpack-persistent-caching" />

### Module Federation

ãƒªãƒã‚¸ãƒˆãƒªé–“(ãƒãƒ³ãƒ‰ãƒ«é–“)ã‚’è·¨ãã¨ãã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã®é‡è¤‡ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åŠ¹ç‡ã‚ˆãæ‰±ã„ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’ä¸‹ã’ã‚‹ä»•çµ„ã¿ã§ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ãŠäº’ã„ã® webpack ã¨é€£æºã‚’å–ã‚Šåˆã†å¿…è¦ãŒã‚ã‚‹ãŸã‚äº’ã„ã« webpack@5 ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![](../../assets/images/blog/webpack5/mf.png)

è©³ã—ãã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

<OG url="https://blog.hiroppy.me/entry/module-federation" />

### assetModules type ã®è¿½åŠ 

ä»Šã¾ã§ç”»åƒãªã©ã‚’èª­ã¿è¾¼ã‚€ã¨ãã«ã€file-loader ã‚„ url-loader, raw-loader ãªã©ã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸãŒãã‚ŒãŒãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

```javascript
module.exports = {
  output: {
    assetModuleFilename: "images/[hash][ext]",
  },
  module: {
    rules: [
      {
        test: /\.(png|jpg|gif)$/,
        type: "asset/resource",
      },
    ],
  },
};
```

è©³ã—ãã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

<OG url="https://blog.hiroppy.me/entry/webpack-asset-modules" />

### ãƒãƒ£ãƒ³ã‚¯åãŒ ID ã¸å¤‰æ›´

ä»Šã¾ã§ä»¥ä¸‹ã®ã‚ˆã†ã«`webpackChunkName`ã¨æ›¸ã‹ãªã‘ã‚Œã°èª­ã‚ãªã„ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãªã£ã¦ã„ã¾ã—ãŸãŒã€äººãŒèª­ã‚ã‚‹å½¢ã¨ãªã‚Šã¾ã™ã€‚ãã‚Œã«ä¼´ã„ã€é–‹ç™ºä¸­ã§ã®`webpackChunkName`ã®æŒ‡å®šã‚’ã™ã‚‹å¿…è¦ãŒãªããªã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

```javascript
(async () => {
  await import(/* webpackChunkName: "foo" */ "./foo");
})();
```

åå‰ã‚’ã¤ã‘ãŸã¨ãã®å‡ºåŠ›

```
asset main.js 2.79 KiB [emitted] [minimized] (name: main)
asset foo.js 114 bytes [emitted] [minimized] (name: foo)
runtime modules 7.23 KiB 10 modules
cacheable modules 217 bytes
  ./src/index.js 190 bytes [built] [code generated]
  ./src/foo.js 27 bytes [built] [code generated]
webpack 5.0.0-rc.4 compiled successfully in 274 ms
```

v5 ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«`deterministic`ã¨ã„ã†è¨­å®šã®æ–°ã—ã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒè¿½åŠ ã•ã‚Œã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«/ãƒãƒ£ãƒ³ã‚¯ã®åå‰ã« 3~4 æ¡ã®æ•°å€¤ ID ãŒä»˜ä¸ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ID ã«ã‚ˆã‚‹ gzip ã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã¯ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚

```
asset main.js 2.79 KiB [emitted] [minimized] (name: main)
asset 717.js 114 bytes [emitted] [minimized]
runtime modules 7.23 KiB 10 modules
cacheable modules 186 bytes
  ./src/index.js 159 bytes [built] [code generated]
  ./src/foo.js 27 bytes [built] [code generated]
webpack 5.0.0-rc.4 compiled successfully in 283 ms
```

ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è‡ªå‹•çš„ã«ä»˜ä¸ã—ãŸã„å ´åˆ

```javascript
module.exports = {
  optimization: {
    chunkIds: "named",
  },
};
```

<br />
``` asset main.js 2.8 KiB [emitted] [minimized] (name: main) asset src_foo_js.js
123 bytes [emitted] [minimized] runtime modules 7.23 KiB 10 modules cacheable
modules 186 bytes ./src/index.js 159 bytes [built] [code generated] ./src/foo.js
27 bytes [built] [code generated] webpack 5.0.0-rc.4 compiled successfully in
256 ms ```

`optimization.chunkIds` ã« `named` ã‚’è¿½åŠ ã™ã‚Œã°ãƒ•ã‚¡ã‚¤ãƒ«åãŒç¢ºå®šã—ã¾ã™ãŒæœ¬ç•ªç’°å¢ƒã§ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ã„ã‚‚ã®ãªã®ã‹ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€`optimization.splitChunks.name`ã¯ãªããªã£ãŸã®ã§ã“ã¡ã‚‰ã«ç§»è¡Œã—ã¦ãã ã•ã„ã€‚

### import.meta ã®ã‚µãƒãƒ¼ãƒˆ

```javascript
// ./src/index.js
console.log(import.meta.url);
console.log(import.meta.webpack);
```

<br />
```javascript // ./dist/main.js //
ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯å›ºå®šå€¤ã¨ã—ã¦å…¥ã‚Šã€import.meta.url, webpackã¯å­˜åœ¨ã—ãªããªã‚‹
console.log("file:///Users/hiroppy/webpack/src/index.js"); console.log(5); ```

ã¾ãŸã€HMR æ™‚ã«ä»Šã¾ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã‹ã‚‰ã¯`import.meta.webpackHot`ã‚’ä½¿ã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã‚Šã€Node.js ã® module ã¸ã®ä¾å­˜ã‚’æ¸›ã‚‰ã—ã€ESM ã«æ²¿ã†ã‚ˆã†ãªæ›¸ãæ–¹ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

```javascript
// <= 4
if (module.hot) {
  module.hot.accept();
}

// >= 5
if (import.meta.webpackHot) {
  import.meta.webpackHot.accept();
}

// or
import.meta.webpackHot?.accept();
```

### `data`, `file`, `http(s)`ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã‚µãƒãƒ¼ãƒˆ

```javascript
import x from "data:text/javascript,export default 42";
console.log(x); // 42

import y from "file:///Users/hiroppy/webpack/src/index.js";
```

ã¾ãŸã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ(`#`)ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

```javascript
const eIndexOf = require("es5-ext/array/\0#/e-index-of#fragment");
```

http(s)ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã¾ã å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ä»¥ä¸‹ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

```javascript
const webpack = require("webpack");

module.exports = {
  plugins: [
    new webpack.experiments.schemes.HttpUriPlugin(),
    new webpack.experiments.schemes.HttpsUriPlugin(),
  ],
};

// index.js
import codeOfConduct from "https://raw.githubusercontent.com/webpack/webpack/master/CODE_OF_CONDUCT.md";
console.log(codeOfConduct);
```

### Native Worker ã®ã‚µãƒãƒ¼ãƒˆ

`new Worker(new URL('...', import.meta.url))`ãŒ WebWorker ã‚’ä½œã‚‹ã‚ˆã†ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã¯ SharedWorker ã‚‚åŒæ§˜ã§ã™ã€‚

```javascript
const fooWorker = new SharedWorker(
  new URL("./foo-worker.js", import.meta.url),
  {
    name: "foo",
  },
);
```

### publicPath ã®è‡ªå‹•åŒ–

æ–°ã—ããƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦`auto`ãŒè¿½åŠ ã•ã‚Œã€`document.currentScript`, `document.getElementsByTagName('script')`, `self.location` ã®ä¸­ã‹ã‚‰è‡ªå‹•çš„ã«æ±ºå®šã•ã‚Œã¾ã™ã€‚æ³¨æ„ç‚¹ã¨ã—ã¦ã€IE ã§ã¯`document.currentScript`ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€deferred ã‹ async ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

```javascript
module.exports = {
  output: {
    publicPath: "auto",
  },
};
```

### Tree Shaking ã®æœ€é©åŒ–

ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å ´åˆã€ä»Šã¾ã§ã¯ä½¿ã‚ã‚Œã¦ã„ãªã„`b`ã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã§ã—ãŸãŒ v5 ã‹ã‚‰ã¯è¿½è·¡å¯èƒ½ã¨ãªã‚Šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```javascript
// inner.js
export const a = 1;
export const b = 2;

// module.js
import * as inner from "./inner";
export { inner };

// user.js
import * as module from "./module";
console.log(module.inner.a);
```

v4 ã§ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é–¢ä¿‚æ€§ã—ã‹è¦‹ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€v5 ã‹ã‚‰å…¥ã£ãŸ`optimization.innerGraph`ã«ã‚ˆã‚Šã€å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¸ã®æœ€é©åŒ–ã‚‚è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```javascript
import { something } from "./something";

function usingSomething() {
  return something;
}

export function test() {
  return usingSomething();
}
```

ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ãŒå¯¾è±¡ã§ã™ã€‚

- é–¢æ•°å®£è¨€
- ã‚¯ãƒ©ã‚¹å®£è¨€
- å¤‰æ•°å®£è¨€ åŠã³ `export default`

`Optimization.sideEffects`ã§ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‰¯ä½œç”¨ã®ãªã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å˜ç´”ãªã‚±ãƒ¼ã‚¹ã‚’æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚¯ãƒ©ã‚¹ãŠã‚ˆã³é–¢æ•°å®£è¨€ã€ç°¡å˜ãª init å¼ã‚’ä½¿ç”¨ã—ãŸå¤‰æ•°å®£è¨€ã€`if`ã€`while`ã€`for`ã€`switch`ã€`export`ã€`import`ã€ç°¡å˜ãªãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ãŸé–¢æ•°å‘¼ã³å‡ºã— ç­‰ã§ã™ã€‚

ã¾ãŸã€CJS ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

- `module.exports = require('...')`
- `module.exports.a.b.c = require('...').a.b.c`
- `Object.defineProperty(module.exports, 'xxx', ...)`
- `require('abc').xxx`

ã“ã®ã‚µãƒãƒ¼ãƒˆã¯ã€ESMã€CJS é–“ã§ã‚‚å‹•ãã®ã§ã€ä»Šå¾Œã©ã¡ã‚‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚’æ°—ã«ã›ãšã«æœ€é©åŒ–è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã¯åˆ¥ã®è¨˜äº‹ã§è©³ç´°ã«èª¬æ˜ã™ã‚‹ã®ã§äºˆå®šã§ã™ã€‚

### output.filename, output. chunkFilename ã®é–¢æ•°åŒ–

`output.filename`ã¯ä»Šã¾ã§æ–‡å­—åˆ—ã—ã‹å—ã‘å–ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€é–¢æ•°ã«ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã£ãŸãŸã‚æ›´ã«æŸ”è»Ÿãªè¨­å®šã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

```javascript
module.exports = {
  output: {
    filename: ({ chunk }) => {
      if (chunk.name === "main") return "main.bundle.[contenthash].js";
      return "foo.bundle.[contenthash].js";
    },
  },
};
```

### externalsType ã®è¿½åŠ 

`externalsType`ã«`promise`, `import`, `script`ãŒè¿½åŠ ã•ã‚Œã€ã‚ˆã‚ŠæŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

- promise: `var`ã¨åŒæ§˜ã ãŒã€éåŒæœŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ãªã‚‹
- import: `import()`ã‚’ä½¿ã„ã€éåŒæœŸã®ãƒã‚¤ãƒ†ã‚£ãƒ– ESM ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
- script: `<script>`ã‚’ä½¿ã„ã€äº‹å‰ã«å®šç¾©ã•ã‚ŒãŸã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’å…¬é–‹ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚€

```javascript
module.exports = {
  externalsType: "promise",
};
```

### target ã®è©³ç´°åŒ–ã¨ browserslist ã®ã‚µãƒãƒ¼ãƒˆ

`target`ã«å¯¾ã—ã¦ã€è©³ç´°ãªè¨­å®šãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ é…åˆ—ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ãªã‚Šã€`target: ['web', 'es2015']` ç­‰ã®æ›¸ãæ–¹ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ ã¾ãŸã€browserslist ãŒã•ã‚ŒãŸãŸã‚ã€`web`ã®å ´åˆã¯`target`ã®è¨­å®šã¯ä¸è¦ã¨ãªã‚Šã¾ã™ã€‚

<OG url="https://github.com/browserslist/browserslist" />

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯`target: 'browserslist'`ã¨ãªã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å…ˆã¯å¤‰ã‚ã‚‰ãšã«`web`ã¨ãªã‚Šã¾ã™ã€‚

### TypeScript å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®æä¾›

`@types/webpack`ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸã€‚

```javascript
import { WebpackOptionsNormalized } from "webpack";

const config: WebpackOptionsNormalized = {
  entry: "index.js",
  output: {
    filename: "bundle.js",
  },
};
```

### splitChunks ã§ã®ã‚µã‚¤ã‚ºè¨­å®šå€¤ã®å¤‰æ›´

ä»Šã¾ã§ã¯ã€JS ã®ã¿ã®ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã§ã—ãŸãŒã€ã•ã‚‰ã«è©³ç´°ã«æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      cacheGroups: {
        test: {
          name: "test",
          minSize: {
            javascript: 100,
            webassembly: 100,
            style: 100,
          },
        },
      },
    },
  },
};
```

ã¾ãŸã€æœ¬ç•ªç’°å¢ƒã§ã®`minSize`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯`20k`ã¨ãªã‚Šã¾ã—ãŸã€‚

## å®Ÿé¨“çš„æ®µéš

### top-level-await ã®ã‚µãƒãƒ¼ãƒˆ

ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¯ ESM ã®ä»•æ§˜ã«æ²¿ã„ã¾ã™ãŒã€ã¾ã  stage-3 ãªã®ã§å®Ÿé¨“çš„ãƒ•ã‚§ãƒ¼ã‚ºã§ã™ã€‚

<OG url="https://github.com/tc39/proposal-top-level-await" />

<br />

```javascript
// webpack.config.js
module.exports = {
  experiments: {
    topLevelAwait: true,
  },
};
```

<br />
```javascript const x = await
import("file:///Users/hiroppy/Desktop/webpack-5/src/foo.js");

console.log(x);

````

### script ã‚¿ã‚°ã§ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚µãƒãƒ¼ãƒˆ

ãƒãƒ³ãƒ‰ãƒ«æ™‚ã«ä½¿ã‚ã‚Œã‚‹ IIFE ãŒå–ã‚Šé™¤ã‹ã‚Œã€`<script type="module">`çµŒç”±ã§å‘¼ã³å‡ºã•ã‚Œã‚‹å½¢ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã“ã®å ´åˆã€ä»•æ§˜ã«æ²¿ã„å³æ ¼ãƒ¢ãƒ¼ãƒ‰ã¨é…å»¶ãƒ­ãƒ¼ãƒ‰ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚

```javascript
module.exports = {
  experiments: {
    outputModule: true,
  },
};
````

## ç ´å£Šçš„å¤‰æ›´

### æœ€ä½è¦æ±‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ Node.js@10 ã¸

webpack åŠã³ webpack ã®ã‚³ã‚¢ã«ãŠã‘ã‚‹ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒè¦æ±‚ã™ã‚‹ Node.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æœ€ä½å€¤ã¯ 10 ã¨ãªã‚Šã¾ã™ã€‚

### Node.js ã® polyfill ã®è‡ªå‹•æŒ¿å…¥ãŒå»ƒæ­¢

ãƒ¡ãƒ³ãƒãƒ¼é–“ã§ã‚‚è³›å¦ä¸¡è«–ãŒã‚ã‚Šã¾ã—ãŸãŒã€ç†ç”±ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªç›®çš„ãŒã‚ã‚Šã¾ã™ã€‚

- webpack ã¯ web ã¸å‘ã‹ã£ã¦ã„ã‚‹
- polyfill è‡ªä½“ãŒå®Œå…¨äº’æ›ãªã‚‚ã®ã§ã¯ãªã„
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã®é«˜ã•

è‡ªåˆ†ãŒçµŒé¨“ã—ãŸä¾‹ã¨ã—ã¦ã¯ã€`process`ã‚„`util`ã«ä¾å­˜ã—ã¦ã„ã‚‹ Node.js ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ä½¿ã†å ´åˆãŒã‚ã‚Šã€v5 ã«ä¸Šã’ãŸã‚‰å‹•ã‹ãªããªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

å®Ÿéš›ã« webpack4 ã¾ã§ä½¿ã£ã¦ã„ãŸ polyfill ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚’å‚è€ƒã«ã—ã¦å„è‡ªã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

<OG url="https://github.com/webpack/node-libs-browser" />

ã“ã‚Œã«ä¼´ã„ã€`node.*`ã®ä¸­ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã™ã¹ã¦å»ƒæ­¢ã¨ãªã‚Šã¾ã™ã€‚ ã¾ãŸã€`global`, `__filename`, `__dirname`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`false`ã®å€¤ã¨ãªã‚Šã¾ã™ã€‚

```javascript
module.exports = {
  node: {
    // Buffer: false, ã“ã‚Œã¯å»ƒæ­¢
    global: false,
    __filename: false,
    __dirname: false,
  },
};
```

### JSON ã§ã® named export ã®ç¦æ­¢

ESM ã®ä»•æ§˜ä¸Šã€ã“ã‚Œã¯è¨±å¯ã•ã‚Œã¦ã„ãªã„ãŸã‚ã“ã‚ŒãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®å ´åˆè­¦å‘ŠãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```javascript
// ğŸ˜µ
import { version } from "./package.json";

// ğŸ™‚
import package from "./package.json";
const { version } = package;
```

### loader ã¨ use ã®é•ã„ã‚’å³æ ¼åŒ–

`rules.loader`ã¨`rules.use`ã§ç›®çš„ã«åˆã£ã¦ãªã„ä½¿ã„æ–¹ã®è¨­å®šã®å ´åˆã€ã‚¨ãƒ©ãƒ¼ã‚’åãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ `use`ã¯`options`ãŒãªã„å ´åˆã®ã¿ä½¿ç”¨å¯èƒ½(å¼•æ•°ã¯å—ã‘å…¥ã‚Œå¯)ã¨ãªã‚Šã€`options`ãŒã‚ã‚‹å ´åˆã¯`loader`ã‚’ä½¿ã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

<TwitterCard id="1305382072698118146" height={640} />

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒä¸€éƒ¨ ES2015 ã¸å¤‰æ›´

webpack ã®ç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒä¸€éƒ¨ es5 ã‹ã‚‰ es2015 ã¨ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã‚ãã¾ã§ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™ã“ã¨ãŒç›®çš„ãªãŸã‚ã€`var`ã‹ã‚‰`const`ã«ã¯ãªã£ãŸã‚Šã›ãšã€`function`ã‚’`() => {}` ã¨ãªã‚Šã¾ã™ã€‚
ã‚‚ã— IE ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```javascript
module.exports = {
  target: ["web", "es5"],
};
```

ã¾ãŸã€ã“ã‚Œã¯è¿½åŠ æ©Ÿèƒ½ã¨ã—ã¦ç”¨æ„ã•ã‚ŒãŸ browserslist ã‚’ç”¨ã„ã¦å›é¿ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```
# browserslist
last 1 version
```
